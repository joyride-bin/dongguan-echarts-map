!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Y3D=t():e.Y3D=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function o(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,o),i.l=!0,i.exports}return o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=10)}([function(e,t,o){"use strict";o.d(t,"a",function(){return n});var n={};function i(e,t,o){var n=new THREE.Quaternion;n.setFromAxisAngle(t.normalize(),o),e.position.applyQuaternion(n)}String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"gm"),t)},n.convertToPlaneCoords=function(e,t){return[e[0]/180*t,e[1]/180*t]},n.getTooltip=function(e,t){var o=t;return Object.keys(e).forEach(function(t,n){var i="{"+t+"}";-1!=o.indexOf("{"+t+"}")&&(o=o.replaceAll(i,e[t]))}),o},n.mergeJSON=function(e,t){if(0==arguments.length)return{};if(1==arguments.length)return arguments[0];if(null==t&&null!=e)return e;if(null==e&&null!=t)return t;if(null==e&&null==t)return{};for(var o in e)void 0!==t[o]?"object"==typeof e[o]&&e[o].constructor==Object?n.mergeJSON(e[o],t[o]):null===t[o]&&null!=e[o]&&(t[o]=e[o]):t[o]=e[o];return t},n.updateJSON=function(e,t){if(0==arguments.length)return{};if(1==arguments.length)return arguments[0];if(null==e&&null!=t)return{};if(null==t&&null!=e)return e;if(null==e&&null==t)return{};for(var o in t)if(void 0!==e[o])if("object"==typeof e[o]&&e[o].constructor==Object){if(t[o],t[o].constructor!=Object)continue;n.updateJSON(e[o],t[o])}else{if(t[o],t[o].constructor==Object)continue;e[o]=t[o]}return e},n.getClone=function(e){return e?jQuery.extend(!0,{},e):{}},n.randColor=function(){return 16777216*Math.random()},n.randInt=function(e,t){return Math.floor(Math.random()*(e-t+1)+t)},n.isNull=function(e){return null===e||void 0===e},n.rotateAroundLine=function(e,t,o,n){var r=new THREE.Vector3;r.subVectors(o,t),e.position.sub(o),i(e,r,n),e.position.add(o)},n.rotateAroundAxis=function(e,t,o,n){e.position.sub(t),i(e,o,n),e.position.add(t)}},function(e,t,o){"use strict";o.d(t,"a",function(){return a});var n=o(3),i=o(6),r=o(0),a=(o(7),function(e){THREE.Object3D.call(this),n.a.call(this,e),i.a.call(this),this.type="Widge",this.autoInit=!0,this.autoUpdate=!0,this._removeMeshs=[]});a.prototype=Object.assign(THREE.Object3D.prototype,n.a.prototype,i.a.prototype),a.prototype.constructor=a,a.prototype.initParentProperties=function(){return[{name:"component",value:null}]},a.prototype.componentChanged=function(e){r.a.isNull(e)||(this.domEvents=e.domEvents)},a.prototype.addRemoveMesh=function(e){this._removeMeshs.push(e)},a.prototype.disposeMesh=function(e){var t=this._removeMeshs.indexOf(e);r.a.isNull(e.material)||e.material.dispose(),r.a.isNull(e.geometry)||e.geometry.dispose(),e.parent.remove(e),t>-1&&this._removeMeshs.splice(t,1)},a.prototype.disposeAllMesh=function(){this._removeMeshs.forEach(function(e,t){r.a.isNull(e.material)||e.material.dispose(),r.a.isNull(e.geometry)||e.geometry.dispose(),e.parent.remove(e)}),this._removeMeshs.length=0},a.prototype.init=function(){},a.prototype.update=function(e){},a.prototype.keydown=function(e){},a.prototype.keyup=function(e){},a.prototype.click=function(e){},a.prototype.mousedown=function(e){},a.prototype.mouseup=function(e){},a.prototype.mousemove=function(e){},a.prototype.touchstart=function(e){},a.prototype.touchend=function(e){},a.prototype.touchmove=function(e){}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return Component});var __WEBPACK_IMPORTED_MODULE_0__PropertyObject_js__=__webpack_require__(3),__WEBPACK_IMPORTED_MODULE_1__Events_js__=__webpack_require__(6),__WEBPACK_IMPORTED_MODULE_2__Tool_js__=__webpack_require__(0),__WEBPACK_IMPORTED_MODULE_3__util_threex_domevents__=__webpack_require__(7),Component=function(e){this.type="Component",this.scene=null,this.camera=null,this.renderer=null,this.domElement=null,this.container=null,this.domEvents=null,this.guiPanel=null,__WEBPACK_IMPORTED_MODULE_0__PropertyObject_js__.a.call(this,e),__WEBPACK_IMPORTED_MODULE_1__Events_js__.a.call(this),this.component="s",this._removeMeshs=[],this._widges=[],this._gridHelper=null,this._axisHelper=null,this._initStatus=!1,this._statsPanel=null,this._control=null};function _initScene(e){if(null==e.container)e.container=document.createElement("div"),document.body.appendChild(e.container),__WEBPACK_IMPORTED_MODULE_2__Tool_js__.a.isNull(e.width)||__WEBPACK_IMPORTED_MODULE_2__Tool_js__.a.isNull(e.height)?(e.width=window.innerWidth,e.height=window.innerHeight,$(window).on("resize",function(t){e._onWindowResize(t)})):(e.container.style.width=e.width+"px",e.container.style.height=e.height+"px");else{var t=null;if("string"==typeof e.container){if(t=document.getElementById(e.container),__WEBPACK_IMPORTED_MODULE_2__Tool_js__.a.isNull(t))throw"不存在Id为"+e.container+"的对象"}else t=e.container;e.container=t,e.width=$(e.container).width(),e.height=$(e.container).height()}e.resolution=new THREE.Vector2(e.width,e.height),e.container.component=e;var o=new THREE.Scene;e.scene=o,e.backgroundOpacity?e.scene.background=new THREE.Color(e.backgroundColor):e.scene.background=null,_createCamera(e),_createGridHelper(e),_createAxisHelper(e),_createStats(e),_createControl(e);var n=new THREE.WebGLRenderer({alpha:!0,antialias:e.antialias,logarithmicDepthBuffer:e.lgDepthBuffer});n.shadowMap.enabled=e.castShadow,n.setSize(e.width,e.height),e.container.appendChild(n.domElement),n.setPixelRatio(window.devicePixelRatio),n.gammaInput=!0,n.gammaOutput=!0,n.autoClear=!1,n.sortObjects=e.sortObjects,n.generateMipmaps=!1,e.renderer=n,e.domElement=n.domElement,e.domEvents=new __WEBPACK_IMPORTED_MODULE_3__util_threex_domevents__.a.DomEvents(e.camera,e.domElement)}function _createCamera(e){e._option;var t=e.cameraFov,o=e.cameraNear,n=e.cameraFar,i=e.cameraX,r=e.cameraY,a=e.cameraZ,s=new THREE.PerspectiveCamera(t,e.width/e.height,o,n);s.position.z=a,s.position.y=r,s.position.x=i,s.lookAt(new THREE.Vector3(0,0,0)),e.scene.add(s),e.camera=s}function _createAxisHelper(e){if(null==e._axisHelper){e._option;if(e.ahVisible){var t=new THREE.AxesHelper(e.ahSize);e._axisHelper=t,e.scene.add(t),e.addRemoveMesh(t)}}}function _createGridHelper(e){if(null==e._gridHelper){var t=e.gridSize,o=e.gridStep,n=e.gridColorCenterLine,i=e.gridColorGrid;if(e.gridVisible){var r=new THREE.GridHelper(t,o,n,i);e._gridHelper=r,e.scene.add(r),e.addRemoveMesh(r)}}}function _createStats(e){if(null==e._statsPanel&&!0===e.stats){var t=new Stats;e.container.appendChild(t.dom),e._statsPanel=t}}function _createControl(e){__WEBPACK_IMPORTED_MODULE_2__Tool_js__.a.isNull(e._control)&&(e._control=new THREE.OrbitControls(e.camera),e._control.enabled=e.mouseControl)}function _createGui(component){if(null==component.guiPanel&&!0===component.gui){var guiObject=null;"auto"!==component.guiPosition?(guiObject=new dat.GUI({autoPlace:!1}),guiObject.domElement.style.position="absolute",component.container.appendChild(guiObject.domElement)):guiObject=new dat.GUI;var gui=guiObject,guiProperties=component.getGuiProperties(),folderObj={};for(var key in guiProperties){var p=guiProperties[key],config=p.gui;if(__WEBPACK_IMPORTED_MODULE_2__Tool_js__.a.isNull(config.folder))gui=guiObject;else{if(__WEBPACK_IMPORTED_MODULE_2__Tool_js__.a.isNull(folderObj[config.folder])){var f=guiObject.addFolder(config.folder);folderObj[config.folder]=f}gui=folderObj[config.folder]}"color"===p.type?gui.addColor(component,key):__WEBPACK_IMPORTED_MODULE_2__Tool_js__.a.isNull(config.select)?__WEBPACK_IMPORTED_MODULE_2__Tool_js__.a.isNull(config.min)||__WEBPACK_IMPORTED_MODULE_2__Tool_js__.a.isNull(config.max)||__WEBPACK_IMPORTED_MODULE_2__Tool_js__.a.isNull(config.step)?__WEBPACK_IMPORTED_MODULE_2__Tool_js__.a.isNull(config.min)||__WEBPACK_IMPORTED_MODULE_2__Tool_js__.a.isNull(config.max)||!__WEBPACK_IMPORTED_MODULE_2__Tool_js__.a.isNull(config.step)?!__WEBPACK_IMPORTED_MODULE_2__Tool_js__.a.isNull(config.min)&&__WEBPACK_IMPORTED_MODULE_2__Tool_js__.a.isNull(config.max)&&__WEBPACK_IMPORTED_MODULE_2__Tool_js__.a.isNull(config.step)?gui.add(component,key).min(config.min):__WEBPACK_IMPORTED_MODULE_2__Tool_js__.a.isNull(config.min)&&!__WEBPACK_IMPORTED_MODULE_2__Tool_js__.a.isNull(config.max)&&__WEBPACK_IMPORTED_MODULE_2__Tool_js__.a.isNull(config.step)?gui.add(component,key).max(config.min):gui.add(component,key):gui.add(component,key,config.min,config.max):gui.add(component,key).min(config.min).max(config.max).step(config.step):gui.add(component,key,eval(config.select))}if("auto"!==component.guiPosition){var gw=$(guiObject.domElement).width();guiObject.domElement.style.top="0px",guiObject.domElement.style.left=component.width-gw+"px"}component.guiPanel=guiObject}}Component.prototype=Object.assign(__WEBPACK_IMPORTED_MODULE_0__PropertyObject_js__.a.prototype,__WEBPACK_IMPORTED_MODULE_1__Events_js__.a.prototype),Component.prototype.constructor=Component,Component.prototype.isComponent=function(){return!0},Component.prototype.addRemoveMesh=function(e){this._removeMeshs.push(e)},Component.prototype.disposeMesh=function(e){var t=this._removeMeshs.indexOf(e);e.material.dispose(),e.geometry.dispose(),__WEBPACK_IMPORTED_MODULE_2__Tool_js__.a.isNull(e.parent)?this.scene.remove(e):e.parent.remove(e),t>-1&&this._removeMeshs.splice(t,1)},Component.prototype.disposeAllMesh=function(){this._removeMeshs.forEach(function(e,t){e.material.dispose(),e.geometry.dispose(),e.parent.remove(e)}),this._removeMeshs.length=0},Component.prototype.initParentProperties=function(){return[{name:"container",value:null,group:"w"},{name:"lgDepthBuffer",value:!1,group:"w"},{name:"sortObjects",value:!0,group:"w"},{name:"mouseControl",value:!0,group:"w",gui:{}},{name:"backgroundOpacity",value:!0,group:"w",desc:"背景不透明,透明则backgroundColor无效",gui:{}},{name:"backgroundColor",value:3355443,group:"w",type:"color",gui:{}},{name:"antialias",value:!0,group:"w"},{name:"castShadow",value:!0,group:"w",gui:{}},{name:"physicallyCorrectLights",value:!0,group:"w",gui:{}},{name:"cameraFov",value:45,group:"c"},{name:"cameraNear",value:.01,group:"c"},{name:"cameraFar",value:1e4,group:"c"},{name:"cameraX",value:400,group:"c",gui:{folder:"camera"}},{name:"cameraY",value:400,group:"c",gui:{folder:"camera"}},{name:"cameraZ",value:400,group:"c",gui:{folder:"camera"}},{name:"gridVisible",value:!1,group:"g",gui:{folder:"grid helper"}},{name:"gridSize",value:1e3,group:"g",gui:{folder:"grid helper",max:1e3,min:500,step:100}},{name:"gridStep",value:100,group:"g",gui:{folder:"grid helper",max:200,min:10,step:10}},{name:"gridColorCenterLine",value:6118749,group:"g",type:"color",gui:{folder:"grid helper"}},{name:"gridColorGrid",value:8947848,type:"color",group:"g",gui:{folder:"grid helper"}},{name:"ahVisible",value:!1,group:"a",desc:"是否坐标轴辅助线",gui:{folder:"axis helper"}},{name:"ahSize",value:500,group:"a",desc:"坐标轴辅助线大小",gui:{folder:"axis helper",min:200}},{name:"stats",value:!0,desc:"是否显示性能面板"},{name:"gui",value:!0,desc:"是否显示控制面板"}]},Component.prototype.lgDepthBufferChanged=function(e){this.renderer.logarithmicDepthBuffer=e},Component.prototype.castShadowChanged=function(e){this.scene.traverse(function(t){t.isLight&&(t.castShadow=e)})},Component.prototype.physicallyCorrectLightsChanged=function(e){this.renderer.physicallyCorrectLights=e},Component.prototype.backgroundColorChanged=function(e){this.scene.background=new THREE.Color(e)},Component.prototype.backgroundOpacityChanged=function(e){this.scene.background=!0===e?new THREE.Color(this.backgroundColor):null},Component.prototype.cameraXChanged=function(e){this.camera.position.x=e},Component.prototype.cameraYChanged=function(e){this.camera.position.y=e},Component.prototype.cameraZChanged=function(e){this.camera.position.z=e},Component.prototype.gridVisibleChanged=function(e){__WEBPACK_IMPORTED_MODULE_2__Tool_js__.a.isNull(this._gridHelper)||(this._gridHelper.visible=e)},Component.prototype.gridSizeChanged=function(e){__WEBPACK_IMPORTED_MODULE_2__Tool_js__.a.isNull(this._gridHelper)||(this.disposeMesh(this._gridHelper),this._gridHelper=null,_createGridHelper(this))},Component.prototype.gridStepChanged=function(e){__WEBPACK_IMPORTED_MODULE_2__Tool_js__.a.isNull(this._gridHelper)||(this.disposeMesh(this._gridHelper),this._gridHelper=null,_createGridHelper(this))},Component.prototype.gridColorCenterLineChanged=function(e){__WEBPACK_IMPORTED_MODULE_2__Tool_js__.a.isNull(this._gridHelper)||(this.disposeMesh(this._gridHelper),this._gridHelper=null,_createGridHelper(this))},Component.prototype.gridColorGridChanged=function(e){__WEBPACK_IMPORTED_MODULE_2__Tool_js__.a.isNull(this._gridHelper)||(this.disposeMesh(this._gridHelper),this._gridHelper=null,_createGridHelper(this))},Component.prototype.ahVisibleChanged=function(e){__WEBPACK_IMPORTED_MODULE_2__Tool_js__.a.isNull(this._axisHelper)||(this._axisHelper.visible=e)},Component.prototype.ahSizeChanged=function(e){__WEBPACK_IMPORTED_MODULE_2__Tool_js__.a.isNull(this._axisHelper)||(this.disposeMesh(this._axisHelper),this._axisHelper=null,_createAxisHelper(this))},Component.prototype.mouseControlChanged=function(e){__WEBPACK_IMPORTED_MODULE_2__Tool_js__.a.isNull(this._control)||(this._control.enabled=e)},Component.prototype.render=function(e){_initScene(this),!1===this._initStatus&&("function"==typeof this.init&&this.init(),this._initFinish(e))},Component.prototype._initFinish=function(){var e=this;this.occurEvent("initFinish"),this.scene.traverse(function(t){"Widge"==t.type&&(e._widges.push(t),t.component=e)}),this._dispatch("init",null);var t=this;$(this.container).on("keydown",function(e){t._onDocumentKeyDown(e)}),$(this.container).on("keyup",function(e){t._onDocumentKeyUp(e)}),$(this.container).on("click",function(e){t._onDocumentClick(e)}),$(this.container).on("dblclick",function(e){t._onDocumentDblClick(e)}),$(this.container).on("mousedown",function(e){t._onDocumentMouseDown(e)}),$(this.container).on("mouseup",function(e){t._onDocumentMouseUp(e)}),$(this.container).on("mousemove",function(e){t._onDocumentMouseMove(e)}),$(this.container).on("touchstart",function(e){t._onDocumentTouchStart(e)}),$(this.container).on("touchend",function(e){t._onDocumentTouchEnd(e)}),$(this.container).on("touchmove",function(e){t._onDocumentTouchMove(e)}),_createGui(this),this._initStatus=!0;var o=new THREE.Clock,n=(e=this,function(){var t=o.getDelta();e._defaultUpdate(t),"function"==typeof e.update&&e.update(t),e.renderer.clear(),e.renderer.render(e.scene,e.camera),e._dispatch("update",t),requestAnimationFrame(n)});n()},Component.prototype._defaultUpdate=function(e){__WEBPACK_IMPORTED_MODULE_2__Tool_js__.a.isNull(this._statsPanel)||this._statsPanel.update()},Component.prototype._onDocumentKeyDown=function(e){this._dispatch("keydown",e)},Component.prototype._onDocumentKeyUp=function(e){this._dispatch("keyup",e)},Component.prototype._onDocumentClick=function(e){this._dispatch("click",e)},Component.prototype._onDocumentDblClick=function(e){this._dispatch("dblclick",e)},Component.prototype._onDocumentMouseDown=function(e){this._dispatch("mousedown",e)},Component.prototype._onDocumentMouseUp=function(e){this._dispatch("mouseup",e)},Component.prototype._onDocumentMouseMove=function(e){this._dispatch("mousemove",e)},Component.prototype._onDocumentTouchStart=function(e){this._dispatch("touchstart",e)},Component.prototype._onDocumentTouchEnd=function(e){this._dispatch("touchend",e)},Component.prototype._onDocumentTouchMove=function(e){this._dispatch("touchmove",e)},Component.prototype._dispatch=function(e,t){for(var o=0,n=this._widges.length;o<n;o++)"function"==typeof this._widges[o][e]&&("init"===e&&!0===this._widges[o].autoInit?this._widges[o][e](t):("update"===e&&this._widges[o].autoUpdate,this._widges[o][e](t)))},Component.prototype._onWindowResize=function(e){this.width=window.innerWidth,this.height=window.innerHeight;var t=this.width/this.height;this.renderer.setSize(this.width,this.height),this.camera.aspect=t,this.camera.updateProjectionMatrix();var o=$(this.guiPanel.domElement);o.offset({top:0,left:this.width-o.width()})}},function(e,t,o){"use strict";o.d(t,"a",function(){return r});var n=o(0),i=o(5),r=function(e){this._notify=!0,this._option={},this._data={};var t=[];"function"==typeof this.initParentProperties&&(t=this.initParentProperties(),n.a.isNull(t)||r(this,t));var o=this.initProperties();if(null===o||void 0===o||!Array.isArray(o))throw"请正确定义组件的initProperties方法";function r(e,t){for(var o=0;o<t.length;o++)if("object"==typeof t[o]){var n=t[o].name,i=t[o].value,r=Object.keys(t[o]);if(0!=r.length){if(void 0==n||null==n){if(1!=r.length)continue;e._option[r[0]]={name:r[0],value:t[o][r[0]]},n=r[0],i=t[o][r[0]]}else e._option[t[o].name]=t[o];e._data[n]=i}}}r(this,o),this.setFromJson(e),this.propOobserver=new i.a(this,this._data)};r.prototype.setFromJson=function(e){if(!n.a.isNull(e))for(var t in e)void 0!==this._data[t]&&(this._option[t].value=e[t],this._data[t]=e[t])},r.prototype.setPropertyFromJson=function(e,t){if(!n.a.isNull(e)){for(var o in this._notify=!!n.a.isNull(t)||t,e)void 0!==this[o]&&(this[o]=e[o]);this._notify=!0}},r.prototype.initPropertyFromObject=function(e,t,o){if(!n.a.isNull(e)){var i=t;if(n.a.isNull(i)&&(i=""),this._notify=!1,n.a.isNull(o)){var r=e.getAllProperties(),a={};for(var s in r)void 0!==r[s]&&(a[i+s]=r[s].value,this[i+s+"Changed"]=function(t,o,n){e[n]=t});for(var s in r)this._option[s]=r[s],this._data[s]=r[s].value;this.propOobserver.observe(a)}this._notify=!0}},r.prototype.getByGroup=function(e){var t={};for(var o in this._option)this._option[o].group===e&&(t[o]=this[o]);return t},r.prototype.getGuiProperties=function(){var e={};for(var t in this._option)"object"==typeof this._option[t].gui&&(e[t]=this._option[t]);return e},r.prototype.getAllProperties=function(){return this._option},r.prototype.initProperties=function(){return null},r.prototype.initParentProperties=function(){return null}},function(e,t,o){"use strict";o.d(t,"a",function(){return p});var n,i,r=o(0),a=o(1),s=29,l={};function u(e){var t=n.getContext("2d");return t.font=s+"px "+e,t.fillStyle="white",t}function c(e,t,o){var r=s+2,a=o.measureText(t).width;o.fillText(t,l.curX+1,l.curY+24),l[e][t]={x:l.curX+1,y:l.curY,w:a+1},l.curX+=a+2,l.curX>n.width-r&&(l.curX=0,l.curY+=r),i.needsUpdate=!0,l.curY>=n.height&&console.warn("OSU.prefabs.textPlane: Too many fonts and chars!!! Please increase textCanvas.width or textCanvas.height")}var p=function(e){var t=r.a.isNull(e)?{}:e;a.a.call(this,t),this.setFromJson(t),this.textPlant=null};if(p.prototype=Object.create(a.a.prototype),p.prototype.constructor=p,p.addFontASCII=function(e){if(!l[e]){l[e]={};for(var t=u(e),o=32;o<127;o++)c(e,String.fromCharCode(o),t)}},r.a.isNull(document.getElementById("__textplan__canvas__"))){(n=document.createElement("canvas")).id="__textplan__canvas__",n.width=512,n.height=512,(i=new THREE.Texture(n)).flipY=!1,l.curX=0,l.curY=0;p.addFontASCII("Arial")}p.prototype.initProperties=function(){return[{name:"text",value:"标签",desc:"标签显示文字"},{name:"fontName",value:"Arial",desc:"标签字体"},{name:"color",value:65535,desc:"标签文字颜色",type:"color",gui:{folder:"Text"}}]},p.prototype.colorChanged=function(e){r.a.isNull(this.textPlant)||(this.textPlant.material.color=new THREE.Color(e))},p.prototype.textChanged=function(e){r.a.isNull(this.textPlant)||(this.disposeMesh(this.textPlant),this.textPlant=null,this._draw(e))},p.prototype.getSize=function(){var e=new THREE.Vector3(0,0,0);return r.a.isNull(this.textPlant)||(this.textPlant.geometry.computeBoundingBox(),e=this.textPlant.geometry.boundingBox.getSize()),e},p.prototype.init=function(){this._draw(this.text)},p.prototype.update=function(e){r.a.isNull(this.textPlant)||this.textPlant.lookAt(this.component.camera.position)},p.prototype._draw=function(e){var t,o,r,a;void 0===l[this.fontName]&&(l[this.fontName]={});for(var p=new THREE.Geometry,h=0,d=0,_=0,m=0,g=s+2,f=0;f<e.length;f++){var v=e.substr(f,1);if("\n"!=v){var E=l[this.fontName][v];void 0===E&&c(this.fontName,v,u(this.fontName)),t=(E=l[this.fontName][v]).x/n.width,o=(E.x+E.w)/n.width,r=E.y/n.height,a=(E.y+g)/n.height,p.vertices.push(new THREE.Vector3(_,m,0),new THREE.Vector3(_+E.w,m,0),new THREE.Vector3(_,m-g,0),new THREE.Vector3(_+E.w,m-g,0)),p.faces.push(new THREE.Face3(h+1,h,h+2),new THREE.Face3(h+1,h+2,h+3)),h+=4,p.faceVertexUvs[0][d]=[new THREE.Vector2(o,r),new THREE.Vector2(t,r),new THREE.Vector2(t,a)],p.faceVertexUvs[0][d+1]=[new THREE.Vector2(o,r),new THREE.Vector2(t,a),new THREE.Vector2(o,a)],d+=2,_+=E.w}else _=0,m-=1.1*g}p.computeBoundingBox();var y=p.boundingBox,w=new THREE.Vector3;y.getSize(w),p.vertices.forEach(function(e,t){e.x=e.x-w.x/2}),p.uvsNeedUpdate=!0;var C=new THREE.MeshBasicMaterial({map:i,transparent:!0,color:this.color}),T=new THREE.Mesh(p,C);this.textPlant=T,this.addRemoveMesh(T),this.add(T)}},function(e,t,o){"use strict";o.d(t,"a",function(){return n});var n=function(e,t){this.object=e,this.observe(t)};n.prototype.observe=function(e){"object"==typeof e&&Object.keys(e).forEach(t=>{this.defineReative(this.object,t,e[t])})},n.prototype.defineReative=function(e,t,o){var n=new i;if(Object.defineProperty(e,t,{enumerable:!0,configurable:!0,get:function(){return i.target&&n.addWatcher(i.target),o},set:function(e){o!==e&&(n.notify(e),o=e)}}),"function"==typeof this.object[t+"Changed"]){var a=this.object;new r(a,t,function(e,o){a[t+"Changed"](e,o,t)})}};var i=function(){this.watchers=[],this.target=null};i.prototype.addWatcher=function(e){this.watchers.push(e)},i.prototype.notify=function(e){this.watchers.forEach(t=>{t.update(e)})};var r=function(e,t,o){this.data=e,this.key=t,this.cb=o,this.value=this.get()};r.prototype.update=function(e){var t=this.value;e!==t&&(this.cb(e,t),this.value=e)},r.prototype.get=function(){return i.target=this,this.value=this.data[this.key],i.target=null,this.value}},function(e,t,o){"use strict";o.d(t,"a",function(){return i});var n=o(0),i=function(){this._eventFuns={},this.domEvents=null};i.prototype.occurEvent=function(){if(0!=arguments.length){var e=arguments[0],t=[];if(arguments.length>1)for(var o=1;o<arguments.length;o++)t.push(arguments[o]);if(!n.a.isNull(this._eventFuns[e]))for(var i=0;i<this._eventFuns[e].length;i++)this._eventFuns[e][i].apply(this,t)}},i.prototype.bindMeshEvent=function(e,t,o){for(var n=this,i=0;i<t.length;i++){var r=t[i];this.domEvents.bind(e,r,function(e){n.occurEvent(e.type,e)})}},i.prototype.bindAllMeshEvent=function(e){this.bindMeshEvent(e,i.eventNames)},i.prototype.removeMeshEvent=function(e,t){for(var o=0;o<t.length;o++){var n=t[o];this.domEvents.unbind(e,n)}},i.prototype.removeAllMeshEvent=function(e,t){this.removeMeshEvent(e,i.eventNames)},i.prototype.on=function(e,t){null==this._eventFuns[e]||void 0===this._eventFuns[e]?(this._eventFuns[e]=[],this._eventFuns[e].push(t)):this._eventFuns[e].push(t)},i.eventNames=["click","dblclick","mouseover","mouseout","mousemove","mousedown","mouseup","contextmenu","touchstart","touchend"]},function(e,t,o){"use strict";o.d(t,"a",function(){return n});var n=n||{};n.DomEvents=function(e,t){this._camera=e||null,this._domElement=t||document,this._raycaster=new THREE.Raycaster,this._selected=null,this._boundObjs={};var o=this;this._$onClick=function(){o._onClick.apply(o,arguments)},this._$onDblClick=function(){o._onDblClick.apply(o,arguments)},this._$onMouseMove=function(){o._onMouseMove.apply(o,arguments)},this._$onMouseDown=function(){o._onMouseDown.apply(o,arguments)},this._$onMouseUp=function(){o._onMouseUp.apply(o,arguments)},this._$onTouchMove=function(){o._onTouchMove.apply(o,arguments)},this._$onTouchStart=function(){o._onTouchStart.apply(o,arguments)},this._$onTouchEnd=function(){o._onTouchEnd.apply(o,arguments)},this._$onContextmenu=function(){o._onContextmenu.apply(o,arguments)},this._domElement.addEventListener("click",this._$onClick,!1),this._domElement.addEventListener("dblclick",this._$onDblClick,!1),this._domElement.addEventListener("mousemove",this._$onMouseMove,!1),this._domElement.addEventListener("mousedown",this._$onMouseDown,!1),this._domElement.addEventListener("mouseup",this._$onMouseUp,!1),this._domElement.addEventListener("touchmove",this._$onTouchMove,!1),this._domElement.addEventListener("touchstart",this._$onTouchStart,!1),this._domElement.addEventListener("touchend",this._$onTouchEnd,!1),this._domElement.addEventListener("contextmenu",this._$onContextmenu,!1)},n.DomEvents.prototype.destroy=function(){this._domElement.removeEventListener("click",this._$onClick,!1),this._domElement.removeEventListener("dblclick",this._$onDblClick,!1),this._domElement.removeEventListener("mousemove",this._$onMouseMove,!1),this._domElement.removeEventListener("mousedown",this._$onMouseDown,!1),this._domElement.removeEventListener("mouseup",this._$onMouseUp,!1),this._domElement.removeEventListener("touchmove",this._$onTouchMove,!1),this._domElement.removeEventListener("touchstart",this._$onTouchStart,!1),this._domElement.removeEventListener("touchend",this._$onTouchEnd,!1),this._domElement.removeEventListener("contextmenu",this._$onContextmenu,!1)},n.DomEvents.eventNames=["click","dblclick","mouseover","mouseout","mousemove","mousedown","mouseup","contextmenu","touchstart","touchend"],n.DomEvents.prototype._getRelativeMouseXY=function(e){var t=event.target||event.srcElement,o=t===window?window.innerWidth:t.offsetWidth,n=t===window?window.innerHeight:t.offsetHeight,i=this._getMouse(e);return{x:+i.x/o*2-1,y:-i.y/n*2+1}},n.DomEvents.prototype._getMouse=function(e){let t,o,n={x:0,y:0};var i=e.target||e.srcElement;e.pageX||e.pageY?(t=e.pageX,o=e.pageY):(t=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,o=e.clientY+document.body.scrollTop+document.documentElement.scrollTop);let r=i.getBoundingClientRect();t-=r.left,o-=r.top;let a=i.width/r.width;return n.x=Math.floor(t*a),n.y=Math.floor(o*a),n},n.DomEvents.prototype._objectCtxInit=function(e){e._3xDomEvent={}},n.DomEvents.prototype._objectCtxDeinit=function(e){delete e._3xDomEvent},n.DomEvents.prototype._objectCtxIsInit=function(e){return!!e._3xDomEvent},n.DomEvents.prototype._objectCtxGet=function(e){return e._3xDomEvent},n.DomEvents.prototype.camera=function(e){return e&&(this._camera=e),this._camera},n.DomEvents.prototype.bind=function(e,t,o,i){console.assert(-1!==n.DomEvents.eventNames.indexOf(t),"not available events:"+t),this._objectCtxIsInit(e)||this._objectCtxInit(e);var r=this._objectCtxGet(e);r[t+"Handlers"]||(r[t+"Handlers"]=[]),r[t+"Handlers"].push({callback:o,useCapture:i}),void 0===this._boundObjs[t]&&(this._boundObjs[t]=[]),this._boundObjs[t].push(e)},n.DomEvents.prototype.addEventListener=n.DomEvents.prototype.bind,n.DomEvents.prototype.unbind=function(e,t,o,i){if(console.assert(-1!==n.DomEvents.eventNames.indexOf(t),"not available events:"+t),null!==this._boundObjs[t]&&void 0!==this._boundObjs[t]){this._objectCtxIsInit(e)||this._objectCtxInit(e);var r=this._objectCtxGet(e);r[t+"Handlers"]||(r[t+"Handlers"]=[]);for(var a=r[t+"Handlers"],s=0;s<a.length;s++){var l=a[s];if(o==l.callback&&i==l.useCapture){a.splice(s,1);break}}var u=this._boundObjs[t].indexOf(e);console.assert(-1!==u),this._boundObjs[t].splice(u,1)}},n.DomEvents.prototype.removeEventListener=n.DomEvents.prototype.unbind,n.DomEvents.prototype._bound=function(e,t){var o=this._objectCtxGet(t);return!!o&&!!o[e+"Handlers"]},n.DomEvents.prototype._onMove=function(e,t,o,n){var i=this._boundObjs[e];if(void 0!==i&&0!==i.length){var r=new THREE.Vector2;r.set(t,o),this._raycaster.setFromCamera(r,this._camera);var a=this._raycaster.intersectObjects(i),s=this._selected;if(a.length>0){var l,u,c,p=a[0],h=p.object;this._selected=h,c=this._bound("mousemove",h),null!=s&&s.uuid==h.uuid||(l=this._bound("mouseover",h),u=s&&this._bound("mouseout",s))}else u=s&&this._bound("mouseout",s),this._selected=null;c&&this._notify("mousemove",h,n,p),l&&this._notify("mouseover",h,n,p),u&&this._notify("mouseout",s,n,p)}},n.DomEvents.prototype._onEvent=function(e,t,o,n){var i=this._boundObjs[e];if(void 0!==i&&0!==i.length){var r=new THREE.Vector2;r.set(t,o),this._raycaster.setFromCamera(r,this._camera);var a=this._raycaster.intersectObjects(i,!0);if(0!==a.length){for(var s=a[0],l=s.object,u=this._objectCtxGet(l),c=l.parent;void 0===u&&c;)u=this._objectCtxGet(c),c=c.parent;u&&this._notify(e,l,n,s)}}},n.DomEvents.prototype._notify=function(e,t,o,n){var i=this._objectCtxGet(t),r=i?i[e+"Handlers"]:null;if(console.assert(4===arguments.length),i&&r&&0!==r.length){r=i[e+"Handlers"];for(var a=0;a<r.length;a++){var s=r[a],l=!0;s.callback({type:e,target:t,origDomEvent:o,intersect:n,stopPropagation:function(){l=!1}}),l&&(!1===s.useCapture&&t.parent&&this._notify(e,t.parent,o,n))}}else t.parent&&this._notify(e,t.parent,o,n)},n.DomEvents.prototype._onMouseDown=function(e){return this._onMouseEvent("mousedown",e)},n.DomEvents.prototype._onMouseUp=function(e){return this._onMouseEvent("mouseup",e)},n.DomEvents.prototype._onMouseEvent=function(e,t){var o=this._getRelativeMouseXY(t);this._onEvent(e,o.x,o.y,t)},n.DomEvents.prototype._onMouseMove=function(e){var t=this._getRelativeMouseXY(e);this._onMove("mousemove",t.x,t.y,e),this._onMove("mouseover",t.x,t.y,e),this._onMove("mouseout",t.x,t.y,e)},n.DomEvents.prototype._onClick=function(e){this._onMouseEvent("click",e)},n.DomEvents.prototype._onDblClick=function(e){this._onMouseEvent("dblclick",e)},n.DomEvents.prototype._onContextmenu=function(e){this._onMouseEvent("contextmenu",e)},n.DomEvents.prototype._onTouchStart=function(e){return this._onTouchEvent("touchstart",e)},n.DomEvents.prototype._onTouchEnd=function(e){return this._onTouchEvent("touchend",e)},n.DomEvents.prototype._onTouchMove=function(e){if(1==e.touches.length){e.preventDefault();var t=+e.touches[0].pageX/window.innerWidth*2-1,o=-e.touches[0].pageY/window.innerHeight*2+1;this._onMove("mousemove",t,o,e),this._onMove("mouseover",t,o,e),this._onMove("mouseout",t,o,e)}},n.DomEvents.prototype._onTouchEvent=function(e,t){if(1==t.touches.length){t.preventDefault();var o=+t.touches[0].pageX/window.innerWidth*2-1,n=-t.touches[0].pageY/window.innerHeight*2+1;this._onEvent(e,o,n,t)}}},function(e,t,o){"use strict";o.d(t,"a",function(){return r});var n=o(0),i=o(1),r=(o(13),function(e,t,o){var r=n.a.isNull(o)?{}:o;i.a.call(this,r),this.jsonUrl=e,this.radius=t,this.setFromJson(r),this._dtCount=0,this.amountChanged(r.amount),this.colorChanged(r.color)});r.prototype=Object.create(i.a.prototype),r.prototype.constructor=r,r.prototype.initProperties=function(){return[{name:"mouseEffect",value:!0,desc:"鼠标移上去每块地图的效果"},{name:"mouseoverColor",value:1522398,desc:"鼠标移上去每块地图显示的颜色",type:"color",gui:{folder:"map"}},{name:"mouseoverScale",value:1.2,desc:"鼠标移上去每块地图突出比例"},{name:"mouseoverScaleSpeed",value:100,desc:"鼠标移上去每块地图突出是的速度"},{name:"color",value:this._randColor(),group:"m",type:"color",gui:{folder:"map"}},{name:"side",value:THREE.FrontSide,group:"m"},{name:"transparent",value:!0,group:"m",desc:"是否允许透明",gui:{folder:"map"}},{name:"opacity",value:1,group:"m",desc:"不透明度,值0-1,1表示不透明",gui:{folder:"map",max:1,min:0,step:.01}},{name:"visible",value:!0,group:"m"},{name:"flatShading",value:!1,group:"m"},{name:"roughness",value:.8,group:"m",desc:"粗糙度,值0-1,0表示光滑镜面",gui:{folder:"map",max:1,min:0,step:.01}},{name:"metalness",value:.2,group:"m",desc:"金属性质,值0-1,0表示非金属表面",gui:{folder:"map",max:1,min:0,step:.01}},{name:"bumpScale",value:1,group:"m",desc:"凹凸性质,值0-1",gui:{folder:"map",max:1,min:0,step:.01}},{name:"depthTest",value:!0,group:"m",desc:"深度测试"},{name:"depthWrite",value:!0,group:"m",desc:"深度测试"},{name:"steps",value:1,group:"e"},{name:"amount",value:this._randAmount,group:"e"},{name:"bevelEnabled",value:!1,group:"e"},{name:"bevelThickness",value:1,group:"e"},{name:"bevelSize",value:1.5,group:"e"},{name:"bevelSegments",value:10,group:"e"},{name:"outlineColor",value:3109280,desc:"轮廓线颜色",type:"color",gui:{folder:"map"}},{name:"outlineWidth",value:.18,desc:"轮廓线宽度"}]},r.prototype.overWidgeDataChanged=function(e){n.a.isNull(e)||(this._overWidgeDataFun="function"==typeof e?e:function(){return e})},r.prototype.amountChanged=function(e){n.a.isNull(e)||(this._amountFun="function"==typeof e?e:function(){return e})},r.prototype.outlineColorChanged=function(e){n.a.isNull(e)||this.traverse(function(t){"Mesh"==t.type&&"OutlineMesh"==t.widgeType&&(t.material.color=new THREE.Color(e))})},r.prototype.colorChanged=function(e){var t=this;n.a.isNull(e)||(this._colorFun="function"==typeof e?e:function(){return e},this.traverse(function(e){"Mesh"==e.type&&"GeoJsonMap"==e.widgeType&&(e.material.color=new THREE.Color(t._colorFun()),e.oldColor=e.material.color)}))},r.prototype.opacityChanged=function(e){n.a.isNull(e)||this.transparent&&this.traverse(function(t){"Mesh"==t.type&&"GeoJsonMap"==t.widgeType&&(t.material.opacity=e)})},r.prototype.roughnessChanged=function(e){n.a.isNull(e)||this.traverse(function(t){"Mesh"==t.type&&"GeoJsonMap"==t.widgeType&&(t.material.roughness=e)})},r.prototype.metalnessChanged=function(e){n.a.isNull(e)||this.traverse(function(t){"Mesh"==t.type&&"GeoJsonMap"==t.widgeType&&(t.material.metalness=e)})},r.prototype.bumpScaleChanged=function(e){n.a.isNull(e)||this.traverse(function(t){"Mesh"==t.type&&"GeoJsonMap"==t.widgeType&&(t.material.bumpScale=e)})},r.prototype.init=function(){var e=this;$.getJSON(this.jsonUrl,function(t){e.drawThreeGeo(t),e.occurEvent("loaded")}),this.mouseEffect&&(this.on("mouseover",function(t){var o=t.target;if(console.log("map over:"+o.uuid),!0!==o.selected){o.current=!0,o.oldColor=o.material.color.getHex(),o.material.color=new THREE.Color(e.mouseoverColor),o.outlineMesh.material.visible=!1;var n={scale:1};new TWEEN.Tween(n).to({scale:e.mouseoverScale},e.mouseoverScaleSpeed).onUpdate(function(){1==o.current?o.scale.set(1,1,n.scale):(o.scale.set(1,1,1),o.outlineMesh.material.visible=!0)}).start()}}),this.on("mouseout",function(e){var t=e.target;!0!==t.selected&&(t.material.color=new THREE.Color(t.oldColor),t.outlineMesh.material.visible=!0,t.scale.set(1,1,1),t.current=!1)}),this.on("click",function(e){var t=e.target;this._currentSelected!=t&&(n.a.isNull(this._currentSelected)||this.clearSelected()),t.selected=!0,this._currentSelected=t}))},r.prototype.clearSelected=function(){n.a.isNull(this._currentSelected)||(this._currentSelected.selected=!1,this._currentSelected.scale.set(1,1,1),this._currentSelected.outlineMesh.material.visible=!0,this._currentSelected.material.color=new THREE.Color(this._currentSelected.oldColor),this._currentSelected=null)},r.prototype.getSelected=function(){return this._currentSelected},r.prototype.update=function(e){this.occurEvent("update",e)},r.prototype.getCP=function(e,t){var o=e;n.a.isNull(o)&&(o="name");for(var i=null,r=0;r<this._mapArr.length;r++){if(this._mapArr[r].mapProperties[o]===t){i=this._mapArr[r];break}}return null!=i?{x:i.cp.x,y:i.cp.y,z:i.cp.z}:null},r.prototype._colorFun=function(){return n.a.randColor()},r.prototype._amountFun=function(){return 10},r.prototype._randColor=function(e){return null==e||void 0===e?n.a.randColor():function(){return e}},r.prototype._randAmount=function(e){return null==e||void 0===e?10:function(){return e}},r.prototype._randOverWidgeData=function(){return{value:n.a.randInt(10,100),tooltip:"随机数据"}},r.prototype.drawThreeGeo=function(e){var t=this,o=this.radius,i=[],r=[],a=[];t.position.x=0,t.position.y=0,t.position.z=0,t._option.opacity;var s=function(e){var t=[];if("Feature"==e.type)n.a.isNull(e.properties)||(e.geometry.properties=e.properties),t.push(e.geometry);else if("FeatureCollection"==e.type)for(var o=0;o<e.features.length;o++)n.a.isNull(e.features[o].properties)||(e.features[o].geometry.properties=e.features[o].properties),t.push(e.features[o].geometry);else{if("GeometryCollection"!=e.type)throw new Error("The geoJSON is not valid.");for(var i=0;i<e.geometries.length;i++)n.a.isNull(e.properties)||(e.geometries[i].properties=e.properties),t.push(e.geometries[i])}return t}(e),l=function(e){var t;if("sphere"==e)t=x;else{if("plane"!=e)throw new Error("The shape that you specified is not valid.");t=b}return t}("plane"),u=[],c=0,p=0,h=0,d=0,_=[];this._mapArr=_;for(var m=0;m<s.length;m++){var g=s[m].properties;if("Polygon"==s[m].type)for(var f=0;f<s[m].coordinates.length;f++){u=y(s[m].coordinates[f]);for(var v=0;v<u.length;v++)l(u[v],o);"line"==t._option.showType?M(r,a,i,g):_.push(P(r,a,i,g))}else{if("MultiPolygon"!=s[m].type)throw new Error("The geoJSON is not valid.");for(var E=0;E<s[m].coordinates.length;E++)for(f=0;f<s[m].coordinates[E].length;f++){u=y(s[m].coordinates[E][f]);for(v=0;v<u.length;v++)l(u[v],o);"line"==t._option.showType?M(r,a,i,g):_.push(P(r,a,i,g))}}}c/=p,h/=d,this.mapCount=_.length;function y(e){for(var t=[],o=[],n=0;n<e.length;n++){var i=e[n],r=e[n-1];if(n>0)if(w(r,i)){o=C(o=[r,i]);for(var a=0;a<o.length;a++)t.push(o[a])}else t.push(i);else t.push(i)}return t}function w(e,t){var o=t[0],n=t[1],i=e[0],r=e[1],a=Math.abs(o-i),s=Math.abs(n-r);return a>5||s>5}function C(e){for(var t,o,n=[],i=0;i<e.length-1;i++)t=e[i],w(o=e[i+1],t)?(n.push(t),n.push(T(t,o))):n.push(t);return n.push(e[e.length-1]),n.length>e.length?n=C(n):n}function T(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}function x(e,t){var o=e[0],n=e[1];i.push(Math.cos(n*Math.PI/180)*Math.cos(o*Math.PI/180)*t),r.push(Math.cos(n*Math.PI/180)*Math.sin(o*Math.PI/180)*t),a.push(Math.sin(n*Math.PI/180)*t)}function b(e,t){var o=e[0],n=e[1]/180*t;h+=n,d++,a.push(n);var i=o/180*t;c+=i,p++,r.push(i)}function M(e,o,n,i){var r=new THREE.Geometry;!function(e,t,o,n){for(var i=0;i<t.length;i++)e.vertices.push(new THREE.Vector3(t[i],o[i],n[i]))}(r,e,o,n);var a=new THREE.LineBasicMaterial,s=new THREE.Line(r,a);t.add(s),R()}function P(e,o,i,r){var a=[],s=0,l=0,u=[];u.push(new THREE.Vector2(0,0)),u.push(new THREE.Vector2(0,t.outlineWidth)),u.push(new THREE.Vector2(.1,t.outlineWidth)),u.push(new THREE.Vector2(.1,0));for(var c=new THREE.Shape(u),p=new THREE.Geometry,h=new THREE.Vector3(e[0],o[0],0),d={steps:1,bevelEnabled:!1},_=0;_<e.length;_++){a.push(new THREE.Vector2(e[_],o[_]));var m=new THREE.Vector3(e[_],o[_],0),g=null;g=_==e.length-1?h:new THREE.Vector3(e[_+1],o[_+1],0);var f=new THREE.LineCurve3(m,g);d.extrudePath=f;var v=new THREE.ExtrudeGeometry(c,d);p.merge(v,v.matrix),s+=e[_],l+=o[_]}s/=e.length,l/=e.length;var E=new THREE.MeshBasicMaterial({color:t.outlineColor,wireframe:!1}),y=new THREE.Mesh(p,E);y.widgeType="OutlineMesh",t.add(y);var w=new THREE.Shape(a),C=t._amountFun(r),T=t.getByGroup("e");T.amount=C;var x=new THREE.ExtrudeGeometry(w,T),b=t._colorFun(r),M=t.getByGroup("m");M.color=b,M.roughness=1;var P=new THREE.Mesh(x,new THREE.MeshStandardMaterial(M));if(x.mesh=P,P.oldColor=b,P.outlineMesh=y,P.widgeType="GeoJsonMap",P.receiveShadow=!0,P.amount=C,n.a.isNull(r.cp)&&n.a.isNull(r.center))P.centerX=s,P.centerY=l;else{var S=r.cp;n.a.isNull(S)&&(S=r.center),S=n.a.convertToPlaneCoords(S,t.radius),P.centerX=S[0],P.centerY=S[1]}return P.mapProperties=r,t.add(P),t.addRemoveMesh(P),t.bindMeshEvent(P,["click","mouseover","mouseout"]),R(),P}function R(){i.length=0,r.length=0,a.length=0}_.forEach(function(e,o){e.translateX(-c),e.translateY(-h),e.outlineMesh.translateX(-c),e.outlineMesh.translateY(-h),e.outlineMesh.translateZ(e.amount+.1),e.cp=new THREE.Vector3(e.centerX-c,e.centerY-h,0),e.onBeforeRender=function(o,i,r,a,s,l){n.a.isNull(a.firstRender)&&t.occurEvent("mapBeforeRender",e,this.mapProperties,e.cp.x,e.cp.y,e.cp.z,e.amount)},e.onAfterRender=function(o,i,r,a,s,l){n.a.isNull(a.firstRender)&&(a.firstRender=!0,t.occurEvent("mapAfterRender",e,this.mapProperties,e.cp.x,e.cp.y,e.cp.z,e.amount))}})}},function(e,t,o){"use strict";o.d(t,"a",function(){return a});var n=o(0),i=o(1),r=o(4),a=function(e){var t=n.a.isNull(e)?{}:e;i.a.call(this,t),this.setFromJson(t),this.h=1,this.preh=1};a.prototype=Object.create(i.a.prototype),a.prototype.constructor=a,a.prototype.initProperties=function(){return[{name:"castShadow",value:!1,desc:"柱子是否投射阴影"},{name:"tooltip",value:"提示",desc:"提示"},{name:"tooltipShow",value:!0,desc:"是否显示提示"},{name:"tooltipColor",value:16777215,type:"color",desc:"提示文字颜色",gui:{}},{name:"tooltipScaleFactor",value:.25,desc:"提示缩放系数"},{name:"radiusTop",value:5,desc:"圆柱顶部圆半径"},{name:"radiusBottom",value:5,group:"c"},{name:"height",value:100,group:"c",desc:"圆柱高度"},{name:"radialSegments",value:20,group:"c",desc:"圆柱圆周分段(影响圆柱面的光滑度)"},{name:"heightSegments",value:1,group:"c",desc:"高度分段"},{name:"animation",value:!0,group:"c"},{name:"speed",value:1e3,group:"c"},{name:"color",value:12831452,group:"m",type:"color",desc:"颜色",gui:{folder:"Cylinder"}},{name:"transparent",value:!0,group:"m",desc:"是否允许透明",gui:{folder:"Cylinder"}},{name:"opacity",value:.8,group:"m",desc:"不透明度,值0-1,1表示不透明",gui:{folder:"Cylinder",max:1,min:0,step:.01}},{name:"visible",value:!0,group:"m"},{name:"roughness",value:.3,group:"m",desc:"粗糙度,值0-1,0表示光滑镜面",gui:{folder:"Cylinder",max:1,min:0,step:.01}},{name:"metalness",value:.35,group:"m",desc:"金属性质,值0-1,0表示非金属表面",gui:{folder:"Cylinder",max:1,min:0,step:.01}},{name:"bumpScale",value:1,group:"m",desc:"凹凸性质,值0-1",gui:{folder:"Cylinder",max:1,min:0,step:.01}}]},a.prototype.tooltipColorChanged=function(e){n.a.isNull(e)||n.a.isNull(this.textSprite)||(this.textSprite.textPlant.material.color=new THREE.Color(e))},a.prototype.castShadowChanged=function(e){n.a.isNull(e)||n.a.isNull(this.cylinder)||(this.cylinder.castShadow=e)},a.prototype.colorChanged=function(e){n.a.isNull(e)||n.a.isNull(this.cylinder)||(this.cylinder.material.color=new THREE.Color(e))},a.prototype.roughnessChanged=function(e){n.a.isNull(e)||n.a.isNull(this.cylinder)||(this.cylinder.material.roughness=e)},a.prototype.bumpScaleChanged=function(e){n.a.isNull(e)||n.a.isNull(this.cylinder)||(this.cylinder.material.bumpScale=e)},a.prototype.metalnessChanged=function(e){n.a.isNull(e)||n.a.isNull(this.cylinder)||(this.cylinder.material.metalness=e)},a.prototype.transparentChanged=function(e){n.a.isNull(e)||n.a.isNull(this.cylinder)||(this.cylinder.material.transparent=e)},a.prototype.opacityChanged=function(e){n.a.isNull(e)||n.a.isNull(this.cylinder)||this.transparent&&(this.cylinder.material.opacity=e)},a.prototype.init=function(){this.drawCylinder()},a.prototype.update=function(e){n.a.isNull(this.textSprite)||this.textSprite.update(e)},a.prototype.drawCylinder=function(){var e=new THREE.CylinderGeometry(this.radiusTop,this.radiusBottom,1,this.radialSegments,this.heightSegments),t=this.getByGroup("m"),o=new THREE.MeshStandardMaterial(t),n=new THREE.Mesh(e,o);n.castShadow=this.castShadow,this.cylinder=n,this.addRemoveMesh(this.cylinder),this.add(n),this.sy={scaleY:1};var i=this;if(this.tooltipShow){var a=new r.a({text:i.tooltip});a.component=this.component,this.textSprite=a}new TWEEN.Tween(this.sy).to({scaleY:i.height},i.speed).onUpdate(function(){var e=i.sy.scaleY;i.cylinder.scale.set(1,e,1)}).start().onComplete(function(){if(i.tooltipShow){a.init(),i.add(a),a.textPlant.scale.set(i.tooltipScaleFactor,i.tooltipScaleFactor,1),a.textPlant.geometry.computeBoundingBox();var e=a.textPlant.geometry.boundingBox.getSize();a.position.set(a.position.x,i.height/2+e.y*i.tooltipScaleFactor,0)}})}},function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o(0);o.d(t,"Tool",function(){return n.a});var i=o(11);o.d(t,"GuiTool",function(){return i.a});var r=o(2);o.d(t,"Component",function(){return r.a});var a=o(12);o.d(t,"ComTest",function(){return a.a});var s=o(15);o.d(t,"ComMap",function(){return s.a});var l=o(9);o.d(t,"Cylinder",function(){return l.a});var u=o(4);o.d(t,"TextPlant",function(){return u.a});var c=o(16);o.d(t,"Point",function(){return c.a});var p=o(17);o.d(t,"FlyLine",function(){return p.a});var h=o(18);o.d(t,"Box",function(){return h.a})},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return GuiTool});var __WEBPACK_IMPORTED_MODULE_0__Tool_js__=__webpack_require__(0),__WEBPACK_IMPORTED_MODULE_1__Observer_js__=__webpack_require__(5),GuiExcutor=function(){this.propOobserver=new __WEBPACK_IMPORTED_MODULE_1__Observer_js__.a(this)};GuiExcutor.prototype.initProperty=function(e,t){if(!__WEBPACK_IMPORTED_MODULE_0__Tool_js__.a.isNull(e)&&!__WEBPACK_IMPORTED_MODULE_0__Tool_js__.a.isNull(t)){var o={};for(var n in t)if(void 0!==t[n]){var i=e+"_"+n;o[i]=t[n].value,this[i+"Changed"]=function(e,t,o){var n=o.split("_"),i=n[0],r=n[1];GuiTool._instances[i].forEach(function(t,o){t[r]=e})}}this.propOobserver.observe(o)}};var GuiTool={};GuiTool.guiExcutor=new GuiExcutor,GuiTool._instances={},GuiTool._properties={},GuiTool.addToGui=function(guiPanel,widge,folder,exclude){if(!__WEBPACK_IMPORTED_MODULE_0__Tool_js__.a.isNull(guiPanel)&&!__WEBPACK_IMPORTED_MODULE_0__Tool_js__.a.isNull(widge)&&!__WEBPACK_IMPORTED_MODULE_0__Tool_js__.a.isNull(folder))if(__WEBPACK_IMPORTED_MODULE_0__Tool_js__.a.isNull(GuiTool._instances[folder])){GuiTool._instances[folder]=[],GuiTool._properties[folder]=widge.getGuiProperties(),GuiTool.guiExcutor.initProperty(folder,GuiTool._properties[folder]),GuiTool._instances[folder].push(widge);var guiProperties=GuiTool._properties[folder],gui=guiPanel.__folders[folder];for(var key in __WEBPACK_IMPORTED_MODULE_0__Tool_js__.a.isNull(gui)&&(gui=guiPanel.addFolder(folder)),guiProperties){var p=guiProperties[key],config=p.gui,newKey=folder+"_"+key;if("color"===p.type){var c=new THREE.Color(GuiTool.guiExcutor[newKey]);GuiTool.guiExcutor[newKey]=c.getHex(),gui.addColor(GuiTool.guiExcutor,newKey)}else __WEBPACK_IMPORTED_MODULE_0__Tool_js__.a.isNull(config.select)?__WEBPACK_IMPORTED_MODULE_0__Tool_js__.a.isNull(config.min)||__WEBPACK_IMPORTED_MODULE_0__Tool_js__.a.isNull(config.max)||__WEBPACK_IMPORTED_MODULE_0__Tool_js__.a.isNull(config.step)?__WEBPACK_IMPORTED_MODULE_0__Tool_js__.a.isNull(config.min)||__WEBPACK_IMPORTED_MODULE_0__Tool_js__.a.isNull(config.max)||!__WEBPACK_IMPORTED_MODULE_0__Tool_js__.a.isNull(config.step)?!__WEBPACK_IMPORTED_MODULE_0__Tool_js__.a.isNull(config.min)&&__WEBPACK_IMPORTED_MODULE_0__Tool_js__.a.isNull(config.max)&&__WEBPACK_IMPORTED_MODULE_0__Tool_js__.a.isNull(config.step)?gui.add(GuiTool.guiExcutor,newKey).min(config.min):__WEBPACK_IMPORTED_MODULE_0__Tool_js__.a.isNull(config.min)&&!__WEBPACK_IMPORTED_MODULE_0__Tool_js__.a.isNull(config.max)&&__WEBPACK_IMPORTED_MODULE_0__Tool_js__.a.isNull(config.step)?gui.add(GuiTool.guiExcutor,newKey).max(config.min):gui.add(GuiTool.guiExcutor,newKey):gui.add(GuiTool.guiExcutor,newKey,config.min,config.max):gui.add(GuiTool.guiExcutor,newKey).min(config.min).max(config.max).step(config.step):gui.add(GuiTool.guiExcutor,newKey,eval(config.select))}}else GuiTool._instances[folder].push(widge)}},function(e,t,o){"use strict";o.d(t,"a",function(){return a});var n=o(2),i=o(8),r=(o(14),o(0)),a=function(e){n.a.call(this,e),this.map=null,this.light=null,this.rotationAngle=0,this.overWidgeArr=[]};a.prototype=Object.assign(n.a.prototype),a.prototype.constructor=a,a.prototype.initProperties=function(){return[{name:"mapJson",value:"js/map/gd.json",desc:"地图",gui:{}},{name:"radius",value:15e3,desc:"墨卡托投影的地球半径"},{name:"rotation",value:!1,desc:"是否旋转",gui:{}},{name:"rotateX",value:-Math.PI/2,gui:{folder:"map"}},{name:"rotateY",value:0,gui:{folder:"map"}},{name:"rotateZ",value:0,gui:{folder:"map"}},{name:"lightX",value:20,group:"l",gui:{folder:"light"}},{name:"lightY",value:36,group:"l",gui:{folder:"light"}},{name:"lightZ",value:-25,group:"l",gui:{folder:"light"}},{name:"lightColor",value:16777215,group:"l",type:"color",gui:{folder:"light"}},{name:"lighIntensity",value:1.6,group:"l",gui:{folder:"light"}},{name:"lightCastShadow",value:!1,group:"l",gui:{folder:"light"}},{name:"toplighIntensity",value:2,group:"l",gui:{folder:"light"}},{name:"groundShow",value:!0,group:"g",desc:"是否显示地面"},{name:"groundWidth",value:1e3,group:"g",desc:"地面宽度",gui:{folder:"ground"}},{name:"groundHeight",value:1,group:"g",desc:"地面厚度"},{name:"groundDepth",value:1e3,group:"g",desc:"地面长度",gui:{folder:"ground"}},{name:"groundImage",value:"",group:"g",desc:"地面贴图，值为图片路径"},{name:"groundImgRepeat",value:1,group:"g",gui:{folder:"ground"}},{name:"groundColor",value:147588,group:"gm",desc:"地板颜色,如果同时贴图，则会融合",type:"color",gui:{folder:"ground"}},{name:"groundOpacity",value:1,group:"gm",desc:"地板透明度",gui:{folder:"ground",max:1,min:0,step:.01}},{name:"groundSpecular",value:0,desc:"地板高光区颜色",group:"gm",type:"color",gui:{folder:"ground"}},{name:"groundShininess",value:0,desc:"地板高光区大小",group:"gm",gui:{folder:"ground"}}]},a.prototype.lightCastShadowChanged=function(e){this.light.castShadow=e},a.prototype.rotateXChanged=function(e){this.map.rotateX(e)},a.prototype.rotateYChanged=function(e){this.map.rotateY(e)},a.prototype.rotateZChanged=function(e){this.map.rotateZ(e)},a.prototype.lightXChanged=function(e){this.light.position.x=e},a.prototype.lightYChanged=function(e){this.light.position.y=e},a.prototype.lightZChanged=function(e){this.light.position.z=e},a.prototype.lightColorChanged=function(e){this.light.color=new THREE.Color(e)},a.prototype.lighIntensityChanged=function(e){this.light.intensity=e},a.prototype.toplighIntensityChanged=function(e){this.topLight.intensity=e},a.prototype.groundColorChanged=function(e){r.a.isNull(this.ground)||(this.ground.material.color=new THREE.Color(e))},a.prototype.groundSpecularChanged=function(e){r.a.isNull(this.ground)||(this.ground.material.specular=new THREE.Color(e))},a.prototype.groundShininessChanged=function(e){r.a.isNull(this.ground)||(this.ground.material.shininess=e)},a.prototype.groundOpacityChanged=function(e){r.a.isNull(this.ground)||(this.ground.material.opacity=e)},a.prototype.groundImgRepeatChanged=function(e){r.a.isNull(this.ground)||r.a.isNull(this.ground.material.map)||(this.ground.material.map.wrapS=this.ground.material.map.wrapT=THREE.RepeatWrapping,this.ground.material.map.repeat.set(e,e))},a.prototype.groundWidthChanged=function(e){r.a.isNull(this.ground)||this.ground.scale.set(e,this.ground.scale.y,this.ground.scale.z)},a.prototype.groundDepthChanged=function(e){r.a.isNull(this.ground)||this.ground.scale.set(this.ground.scale.x,this.ground.scale.y,e)},a.prototype._randOverWidgeData=function(){return{value:r.a.randInt(10,100),tooltip:"随机数据"}},a.prototype.init=function(){TWEEN.removeAll();var e=this;this.scene.add(new THREE.AmbientLight(3355443,.5));var t=new THREE.PointLight(this.lightColor,this.toplighIntensity);this.topLight=t,t.position.set(this.lightX,this.lightY+250,this.lightZ),t.castShadow=!1,this.scene.add(t);var o=new THREE.PointLight(this.lightColor,this.lighIntensity);this.light=o,this.light.position.set(this.lightX,this.lightY,this.lightZ),this.light.castShadow=this.lightCastShadow,this.scene.add(o);var n=new THREE.DirectionalLight(16777215,.5);n.position.set(0,0,300),this.scene.add(n);var a=new THREE.DirectionalLight(16777215,.5);a.position.set(0,0,-300),this.scene.add(a);var s=new THREE.DirectionalLight(16777215,.5);s.position.set(300,0,0),this.scene.add(s);var l=new THREE.DirectionalLight(16777215,.5);if(l.position.set(-300,0,0),this.scene.add(l),this.map=new i.a(this.mapJson,this.radius,{showType:"shape",mouseEffect:!0}),this.mapCount=0,this.map.on("mapAfterRender",function(t,o,n,i,r,a){e.mapCount++,e.mapCount===this.mapCount&&(console.log("全部渲染完毕，总共有:"+e.mapCount+"个图快"),e.occurEvent("allMapRender"))}),this.map.on("mapAfterRender",function(t,o,n,i,r,a){e.occurEvent("mapAfterRender",this,t,o,n,i,r,a)}),this.map.on("click",function(t){var o=t.target;e.occurEvent("mapClick",o.mapProperties,t)}),this.map.rotateX(this.rotateX),this.map.rotateY(this.rotateY),this.scene.add(this.map),this.initPropertyFromObject(this.map),this.groundShow){var u=new THREE.BoxGeometry(1,1,1),c={color:this.groundColor,shininess:this.groundShininess,specular:this.groundSpecular,transparent:!0,opacity:this.groundOpacity};if(!r.a.isNull(this.groundImage)&&""!=this.groundImage.trim()){var p=(new THREE.TextureLoader).load(this.groundImage);p.wrapS=p.wrapT=THREE.RepeatWrapping,p.repeat.set(this.groundImgRepeat,this.groundImgRepeat),c.map=p}var h=new THREE.Mesh(u,new THREE.MeshPhongMaterial(c));h.scale.set(this.groundWidth,this.groundHeight,this.groundDepth),this.ground=h,this.scene.add(this.ground),this.bindMeshEvent(this.ground,["click","mouseover"]),this.on("click",function(e){e.target==this.ground&&this.map.clearSelected()})}},a.prototype.update=function(e){this.occurEvent("update",e),TWEEN.update(),this.rotation&&(this.camera.lookAt(new THREE.Vector3(0,0,0)),r.a.rotateAroundAxis(this.camera,new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0),.001),r.a.rotateAroundAxis(this.light,new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0),.001))}},function(e,t,o){"use strict";var n=o(0),i=o(3),r=function(e,t){n.a.isNull(t);i.a.call(this,t),this.sourceMesh=e,this._init()};(r.prototype=Object.assign(i.a.prototype)).constructor=r,r.prototype.initProperties=function(){return[{name:"glowColor",value:65280,desc:"发光颜色"},{name:"coeficient",value:.1},{name:"power",value:1.2,desc:"发光强度"},{name:"dilate",value:.1,group:"m",desc:"扩大系数，影响发光的范围"}]},r.prototype._init=function(){var e=this.sourceMesh.geometry.clone();!function(e,t){var o=new Array(e.vertices.length);e.faces.forEach(function(e){e instanceof THREE.Face4?(o[e.a]=e.vertexNormals[0],o[e.b]=e.vertexNormals[1],o[e.c]=e.vertexNormals[2],o[e.d]=e.vertexNormals[3]):e instanceof THREE.Face3&&(o[e.a]=e.vertexNormals[0],o[e.b]=e.vertexNormals[1],o[e.c]=e.vertexNormals[2])}),e.vertices.forEach(function(e,n){var i=o[n];e.x+=i.x*t,e.y+=i.y*t,e.z+=i.z*t})}(e,this.dilate);var t,o,n=(t=["varying vec3\tvVertexWorldPosition;","varying vec3\tvVertexNormal;","varying vec4\tvFragColor;","void main(){","\tvVertexNormal\t= normalize(normalMatrix * normal);","\tvVertexWorldPosition\t= (modelMatrix * vec4(position, 1.0)).xyz;","\t// set gl_Position","\tgl_Position\t= projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),o=["uniform vec3\tglowColor;","uniform float\tcoeficient;","uniform float\tpower;","varying vec3\tvVertexNormal;","varying vec3\tvVertexWorldPosition;","varying vec4\tvFragColor;","void main(){","\tvec3 worldCameraToVertex= vVertexWorldPosition - cameraPosition;","\tvec3 viewCameraToVertex\t= (viewMatrix * vec4(worldCameraToVertex, 0.0)).xyz;","\tviewCameraToVertex\t= normalize(viewCameraToVertex);","\tfloat intensity\t\t= pow(coeficient + dot(vVertexNormal, viewCameraToVertex), power);","\tgl_FragColor\t\t= vec4(glowColor, intensity);","}"].join("\n"),new THREE.ShaderMaterial({uniforms:{coeficient:{type:"f",value:1},power:{type:"f",value:2},glowColor:{type:"c",value:new THREE.Color("pink")}},vertexShader:t,fragmentShader:o,transparent:!0,depthWrite:!1}));n.uniforms.glowColor.value=new THREE.Color("cyan"),n.uniforms.coeficient.value=this.coeficient,n.uniforms.power.value=this.power;var i=new THREE.Mesh(e,n);this.glowMesh=i},r.prototype.glowColorChanged=function(e){this.growMesh.material.uniforms.glowColor.value=new THREE.Color(e)},r.prototype.coeficientChanged=function(e){this.growMesh.material.uniforms.coeficient.value=e},r.prototype.powerChanged=function(e){this.growMesh.material.uniforms.power.value=e}},function(e,t,o){"use strict";var n=o(0),i=o(1),r=function(e){var t=n.a.isNull(e)?{}:e;i.a.call(this,t),this.setFromJson(t),this.offsetX=0,this.offsetY=0,this.offsetZ=0};function a(e){n.a.isNull(r._scene2d)&&(r._scene2d=new THREE.Scene,r._scene2d.add(new THREE.AmbientLight(5263440)),r._camera2d=new THREE.OrthographicCamera(0,e.component.width,0,e.component.height,e.component.camera.near,e.component.camera.far),r._camera2d.position.copy(e.component.camera.position),r._camera2d.quaternion.copy(e.component.camera.quaternion))}r.prototype=Object.create(i.a.prototype),r.prototype.constructor=r,r._markers={},r._scene2d=null,r._camera2d=null,r.prototype.initProperties=function(){return[{name:"text",value:"标签",desc:"标签显示文字"},{name:"fontFace",value:"Arial",desc:"标签字体"},{name:"fontSize",value:18,desc:"标签字体大小"},{name:"borderThickness",value:3,desc:"标签边框大小"},{name:"borderColor",value:255,desc:"标签边框颜色"},{name:"backgroundColor",value:0,desc:"标签背景色"},{name:"textColor",value:16777215,desc:"标签文字颜色"}]},r.prototype.colorChanged=function(e){},r.prototype.init=function(){a(this),this._draw()},r.prototype.update=function(){n.a.isNull(this.component)||(!function(e){for(var t=4*e.component.camera.zoom+8,o=Object.keys(r._markers),n=0;n<o.length;n++){var i=r._markers[o[n]];i.marker.update()}for(var a=0;a<8;a++)for(var n=0;n<o.length;n++)for(var s=r._markers[o[n]].marker,l=n+1;l<o.length;l++){var u=r._markers[o[l]].marker,c=s._y+s._dy,p=u._y+u._dy;if(s.labelLeft<u.labelRight&&u.labelLeft<s.labelRight&&c<p+t&&p<c+t){if(s._y<u._y&&c>p||s._y>u._y&&c<p){var h=s._dy;s._dy=u._dy,u._dy=h,c=s._y+s._dy,p=u._y+u._dy}var d=c<=p?c+t-p:c-p-t;s._dy-=d/2,u._dy+=d/2}}for(var n=0;n<o.length;n++){var i=r._markers[o[n]];i.marker.updatePosition()}}(this),this.component.renderer.render(r._scene2d,r._camera2d))},r.prototype.addMarker=function(e){if(a(this),n.a.isNull(r._markers[e.key])){var t=Object.assign({},e);r._markers[e.key]=t,this._draw(t)}},r.prototype._draw=function(e){var t=this,o=this.component.container,i=document.createElement("DIV");i.className="marker",e.marker=i,i.markerInstance=e,o.appendChild(i),i.innerHTML=e.html,i.onLeft=i.markerInstance.onLeft,i.setPosition=function(e,t,o){this._width=this.jquery.outerWidth(!0),this._x=e,this._y=t,this._dy=.95*this._dy||0,this._z=o,this.labelLeft=e+(this.onLeft?-(this._width+48):48),this.labelRight=this.labelLeft+this._width},i.updatePosition=function(){this.style.left=this.labelLeft+"px",this.style.top=this._y+this._dy-(this.selected?27:2*t.component.camera.zoom+4)+"px",this.style.zIndex=this._z;var e=this.line.geometry.attributes.position.array;e[0]=this._x,e[1]=this._y,e[3]=this._x+(this.onLeft?-48:48),e[4]=this._y+this._dy,this.line.geometry.attributes.position.needsUpdate=!0},i.setVisible=function(e){e?(this.style.display="inline",this.line.visible=!0):(this.style.display="none",this.line.visible=!1)},i.jquery=$(i),i.setSize=function(e){this.style.fontSize=e+"pt"},i.update=function(){var e=new THREE.Vector3;n.a.isNull(this.markerInstance.object)?(e.x=this.markerInstance.position[0],e.y=this.markerInstance.position[1],e.z=this.markerInstance.position[2]):this.markerInstance.object.object3d.getWorldPosition(e),n.a.isNull(this.markerInstance.object.ajustX)||(e.x+=this.markerInstance.object.ajustX),n.a.isNull(this.markerInstance.object.ajustY)||(e.y+=this.markerInstance.object.ajustY),n.a.isNull(this.markerInstance.object.ajustZ)||(e.z+=this.markerInstance.object.ajustZ);var o=function(e,t){var o=t.clone();o.project(e.component.camera);var n=new Object,i=$(e.component.container).width(),r=$(e.component.container).height();return n.x=Math.round(o.x*(i/2))+i/2,n.y=Math.round((0-o.y)*(r/2))+r/2,n}(t,e),i=3*t.component.camera.zoom+5;this.setSize(i);var r=Math.floor(1e3+e.z);this.selected&&(r=1e4),this.setPosition(o.x,o.y,r)};var r=new THREE.BufferGeometry;r.addAttribute("position",new THREE.BufferAttribute(new Float32Array([0,0,0,100,100,100]),3));var a=new THREE.Line(r,new THREE.LineBasicMaterial({color:"red"}));a.frustumCulled=!1;var s=new THREE.BoxGeometry(50,200,50);new THREE.Mesh(s,new THREE.MeshBasicMaterial({color:"blue"}));this.component.scene.add(a),i.line=a}},function(e,t,o){"use strict";o.d(t,"a",function(){return s});var n=o(2),i=o(8),r=o(9),a=o(0),s=function(e){n.a.call(this,e),this.map=null,this.light=null,this.rotationAngle=0,this.overWidgeArr=[]};s.prototype=Object.create(n.a.prototype),s.prototype.constructor=s,s.prototype.initProperties=function(){return[{name:"mapJson",value:"gd",desc:"地图",gui:{}},{name:"radius",value:15e3,desc:"墨卡托投影的地球半径"},{name:"rotation",value:!1,desc:"是否旋转",gui:{}},{name:"lightX",value:20,group:"l",gui:{folder:"light"}},{name:"lightY",value:36,group:"l",gui:{folder:"light"}},{name:"lightZ",value:-25,group:"l",gui:{folder:"light"}},{name:"lightColor",value:16777215,group:"l",type:"color",gui:{folder:"light"}},{name:"lighIntensity",value:1.6,group:"l",gui:{folder:"light"}},{name:"lightCastShadow",value:!1,group:"l",gui:{folder:"light"}},{name:"toplighIntensity",value:2,group:"l",gui:{folder:"light"}},{name:"overWidgeType",value:"cylinder",desc:"数据显示叠加物类型"},{name:"overWidgeData",value:this._randOverWidgeData,desc:"数据显示叠加物大小,是一个function"},{name:"odvField",value:"value",desc:"叠加物数据项中哪个字段作为影响高度或大小的值，默认为value"},{name:"dataShowType",value:"overWidge",desc:"数据显示方式,mapColor-颜色值,mapHeight-地图块高低方式,overWidge-叠加物"},{name:"tooltip",value:"请设置提示信息",desc:"叠加物数据项中提示,用{字段名}来获取数据项得值"},{name:"tooltipScaleFactor",value:.25,desc:"叠加物tooltip的缩放因子"},{name:"cylinderRadiusTop",value:5,desc:"圆柱顶部圆半径"},{name:"cylinderRadiusBottom",value:5,group:"c"},{name:"cylinderRadialSegments",value:20,group:"c",desc:"圆柱圆周分段(影响圆柱面的光滑度)"},{name:"cylinderHeightSegments",value:1,group:"c",desc:"高度分段"},{name:"cylinderColor",value:9481697,group:"c",type:"color",desc:"颜色",gui:{folder:"Cylinder"}},{name:"cylinderOpacity",value:.8,group:"c",desc:"不透明度,值0-1,1表示不透明",gui:{folder:"Cylinder",max:1,min:0,step:.01}},{name:"cylinderRoughness",value:.45,group:"c",desc:"粗糙度,值0-1,0表示光滑镜面",gui:{folder:"Cylinder",max:1,min:0,step:.01}},{name:"cylinderMetalness",value:.5,group:"c",desc:"金属性质,值0-1,0表示非金属表面",gui:{folder:"Cylinder",max:1,min:0,step:.01}}]},s.prototype.lightCastShadowChanged=function(e){this.light.castShadow=e},s.prototype.lightXChanged=function(e){this.light.position.x=e},s.prototype.lightYChanged=function(e){this.light.position.y=e},s.prototype.lightZChanged=function(e){this.light.position.z=e},s.prototype.lightColorChanged=function(e){this.light.color=new THREE.Color(e)},s.prototype.lighIntensityChanged=function(e){this.light.intensity=e},s.prototype.toplighIntensityChanged=function(e){this.topLight.intensity=e},s.prototype._randOverWidgeData=function(){return{value:a.a.randInt(10,100),tooltip:"随机数据"}},s.prototype.init=function(){TWEEN.removeAll();var e=this;this.scene.add(new THREE.AmbientLight(3355443,.5));var t=new THREE.PointLight(this.lightColor,this.toplighIntensity);this.topLight=t,t.position.set(this.lightX,this.lightY+250,this.lightZ),t.castShadow=!1,this.scene.add(t);var o=new THREE.PointLightHelper(t,1);this.scene.add(o);var n=new THREE.PointLight(this.lightColor,this.lighIntensity);this.light=n,this.light.position.set(this.lightX,this.lightY,this.lightZ),this.light.castShadow=this.lightCastShadow,this.scene.add(n);var s=new THREE.PointLightHelper(n,1);this.scene.add(s);var l=new THREE.DirectionalLight(16777215,.5);l.position.set(0,0,300),this.scene.add(l);var u=new THREE.DirectionalLight(16777215,.5);u.position.set(0,0,-300),this.scene.add(u);var c=new THREE.DirectionalLight(16777215,.5);c.position.set(300,0,0),this.scene.add(c);var p=new THREE.DirectionalLight(16777215,.5);p.position.set(-300,0,0),this.scene.add(p),this.map=new i.a("js/map/"+this.mapJson+".json",this.radius,{showType:"shape",amount:function(){return 10+100*Math.random()}}),this.map.on("mapAfterRender",function(t,o,n,i,s,l){if("overWidge"===this.dataShowType)if("cylinder"===this.overWidgeType){var u=e.overWidgeData(o),c=a.a.getTooltip(u,e.tooltip),p=new r.a({radiusTop:e.cylinderRadiusTop,radiusBottom:e.cylinderRadiusBottom,height:u[e.odvField],tooltip:c,tooltipScaleFactor:e.tooltipScaleFactor,speed:e.overWidgeSpeed,radialSegments:e.cylinderRadialSegments,heightSegments:e.cylinderHeightSegments,color:e.cylinderColor});p.component=e,p.init(),p.widgeType="OverWidge",p.cylinder.castShadow=!0,this.add(p),p.position.set(n,i,s),p.rotateX(Math.PI/2),p.translateY(p.height/2+l),e.overWidgeArr.push(p)}else this.dataShowType}),this.map.on("update",function(e){this.traverse(function(t){"OverWidge"==t.widgeType&&t.update(e)})}),this.map.rotateX(-Math.PI/2),this.scene.add(this.map),this.initPropertyFromObject(this.map)},s.prototype.update=function(e){TWEEN.update(),this.rotation&&(this.camera.lookAt(new THREE.Vector3(0,0,0)),a.a.rotateAroundAxis(this.camera,new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0),.001),a.a.rotateAroundAxis(this.light,new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0),.001))}},function(e,t,o){"use strict";o.d(t,"a",function(){return r});var n=o(0),i=o(1),r=function(e){var t=n.a.isNull(e)?{}:e;i.a.call(this,t),this.setFromJson(t),this.h=1,this._boxSize=null};r.prototype=Object.create(i.a.prototype),r.prototype.constructor=r,r.prototype.initProperties=function(){return[{name:"radius",value:10,desc:"是否投射阴影"},{name:"widthSegments",value:20,desc:"是否投射阴影"},{name:"heightSegments",value:20,desc:"是否投射阴影"},{name:"castShadow",value:!1,desc:"是否投射阴影"},{name:"animation",value:!0,desc:"是否开启动画"},{name:"type",value:"sphere",desc:"点的类型,默认为球形"},{name:"tooltip",value:"提示",desc:"提示"},{name:"scaleFactor",value:1,desc:"缩放系数"},{name:"color",value:16777215,desc:"颜色",group:"m",type:"color",gui:{folder:"Point"}},{name:"transparent",value:!0,group:"m",desc:"是否允许透明",gui:{folder:"Point"}},{name:"depthTest",value:!0,group:"m",desc:"是否允许透明",gui:{folder:"Point"}},{name:"opacity",value:1,group:"m",desc:"不透明度,值0-1,1表示不透明",gui:{folder:"Point",max:1,min:0,step:.01}},{name:"roughness",value:.5,group:"m",desc:"粗糙度,值0-1,0表示光滑镜面",gui:{folder:"Point",max:1,min:0,step:.01}},{name:"metalness",value:.5,group:"m",desc:"金属性质,值0-1,0表示非金属表面",gui:{folder:"Point",max:1,min:0,step:.01}},{name:"bumpScale",value:1,group:"m",desc:"凹凸性质,值0-1",gui:{folder:"Point",max:1,min:0,step:.01}}]},r.prototype.colorChanged=function(e){n.a.isNull(e)||n.a.isNull(this.point)||(this.point.material.color=new THREE.Color(e))},r.prototype.roughnessChanged=function(e){n.a.isNull(e)||n.a.isNull(this.point)||(this.point.material.roughness=e)},r.prototype.bumpScaleChanged=function(e){n.a.isNull(e)||n.a.isNull(this.point)||(this.point.material.bumpScale=e)},r.prototype.metalnessChanged=function(e){n.a.isNull(e)||n.a.isNull(this.point)||(this.point.material.metalness=e)},r.prototype.transparentChanged=function(e){n.a.isNull(e)||n.a.isNull(this.point)||(this.point.material.transparent=e)},r.prototype.opacityChanged=function(e){n.a.isNull(e)||n.a.isNull(this.point)||this.transparent&&(this.point.material.opacity=e)},r.prototype.getSize=function(e){var t=new THREE.Vector3(0,0,0);return n.a.isNull(this.point)||(e||n.a.isNull(this._boxSize))&&(this.point.geometry.computeBoundingBox(),t=this.point.geometry.boundingBox.getSize(),this._boxSize={width:t.x,height:t.y,depth:t.z}),this._boxSize},r.prototype.init=function(){this.drawPoint()},r.prototype.update=function(e){},r.prototype.drawPoint=function(){var e=new THREE.SphereGeometry(this.radius,this.widthSegments,this.heightSegments),t=this.getByGroup("m"),o=new THREE.MeshStandardMaterial(t),i=new THREE.Mesh(e,o);i.scale.set(this.scaleFactor,this.scaleFactor,this.scaleFactor),i.castShadow=this.castShadow,this.point=i,this.bindMeshEvent(i,["click","mouseover","mouseout"]),this.addRemoveMesh(this.point),this.add(this.point);var r=this;this.animation&&(this.point.onAfterRender=function(e,t,o,i,a,s){if(n.a.isNull(i.firstRender)){i.firstRender=!0,r.py={y:r.position.z};new TWEEN.Tween(r.py).to({y:r.py.y+5},500).repeat(1/0).delay(20).yoyo(!0).onUpdate(function(){var e=r.py.y;r.position.z=e}).start()}})}},function(e,t,o){"use strict";o.d(t,"a",function(){return r});var n=o(1),i=o(0),r=function(e){var t=i.a.isNull(e)?{}:e;n.a.call(this,t),this.setFromJson(t),this._linesGeo=new THREE.Geometry,this._linesBufferPosition=[],this._linesBufferColor=[],this._linesBufferIndex=[],this._linesIndex=0,this._lineColors=[],this._particlesGeo=new THREE.BufferGeometry,this._particlesGeo.vertices=[],this._particlePositions=[],this._particleSizes=[],this._particleColors=[]};r.prototype=Object.create(n.a.prototype),r.prototype.constructor=r,r._vertexShader="\n    uniform float amplitude;\n    attribute float size;\n    attribute vec3 customColor;\n    varying vec3 vColor;\n    void main() {\n        vColor = customColor;\n        vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n        gl_PointSize = size;\n        gl_Position = projectionMatrix * mvPosition;\n    }\n",r._fragmentShader="\n    uniform vec3 color;\n    uniform sampler2D texture;\n    varying vec3 vColor;\n    void main() {\n        gl_FragColor = vec4( color * vColor, 1.0 );\n        gl_FragColor = gl_FragColor * texture2D( texture, gl_PointCoord );\n    }\n",r.prototype.initProperties=function(){return[{name:"pcpu",value:1,desc:"每单位距离的点个数，决定每条线点的密度，值越大线条越圆滑，但性能会损耗"},{name:"singlePoint",value:!1,desc:"每条线是否只有一个点在运动"},{name:"apogeeAxis",value:"y",desc:"最高点的轴方向，默认是y"},{name:"speed",value:.03,desc:"粒子运行速度，全局控制，如果具体某条线设置了运行速度，则会被覆盖"},{name:"pointSize",value:10,desc:"粒子大小，全局控制，如果具体某条线设置了粒子大小，则会被覆盖"},{name:"apogee",value:.7,desc:"弧度最高点到两点之间直线的垂直距离，全局控制，如果具体某条线设置了该值，则会被覆盖"}]},r.prototype.addLine=function(e){if(i.a.isNull(e)||i.a.isNull(e.startPoint)||i.a.isNull(e.endPoint))return!1;i.a.isNull(e.apogee)&&(e.apogee=this.apogee),i.a.isNull(e.color)&&(e.color=i.a.randColor()),i.a.isNull(e.speed)&&(e.speed=this.speed),i.a.isNull(e.pointSize)&&(e.pointSize=this.pointSize);var t=new THREE.Vector3(e.startPoint.x,e.startPoint.y,e.startPoint.z),o=new THREE.Vector3(e.endPoint.x,e.endPoint.y,e.endPoint.z),n=new THREE.Color(e.color),r=function(e,t,o,n,i){var r=e.clone().sub(t).length(),a=e.clone().lerp(t,.5);a[n]+=o*r/2;for(var s=new THREE.QuadraticBezierCurve3(e,a,t),r=e.clone().sub(t).length(),l=s.getPoints(Math.ceil(r*i)),u=new THREE.Geometry,c=0;c<l.length;c++)u.vertices.push(l[c]);return u}(t,o,e.apogee,this.apogeeAxis,this.pcpu),a=0;for(var s in r.vertices){var l=r.vertices[s];this._linesBufferPosition.push(l.x,l.y,l.z),this._linesBufferColor.push(n.r,n.g,n.b),0==this._linesIndex&&0==a?this._linesBufferIndex.push(0):0==a?this._linesBufferIndex.push(this._linesIndex):a==r.vertices.length-1?this._linesBufferIndex.push(this._linesIndex):(this._linesBufferIndex.push(this._linesIndex),this._linesBufferIndex.push(this._linesIndex)),a++,this._linesIndex++}for(var u=n.clone(),c=r.vertices,p=e.pointSize,h=0;h<c.length-1;h++){var d=c[h].clone();!0===this.singlePoint&&0!=h||(d.moveIndex=h,d.nextIndex=h+1,d.nextIndex>=c.length&&(d.nextIndex=0),d.lerpN=0,d.speed=e.speed,d.path=c,this._particlesGeo.vertices.push(d),d.size=p,this._particlePositions.push(d.x,d.y,d.z),this._particleSizes.push(p),this._particleColors.push(u.r,u.g,u.b))}return!0},r.prototype.addDynLine=function(e){if(i.a.isNull(e)||i.a.isNull(e.startPoint)||i.a.isNull(e.endPoint))return!1;var t=this._particlesGeo.clone(),o=this._particlesGeo.vertices;this.disposeAllMesh(),this._particlesGeo=t,this._particlesGeo.vertices=o,this.addLine(e),this._draw()},r.prototype.init=function(){this._draw()},r.prototype.update=function(e){null!=this.pointSystem&&this.pointSystem.update()},r.prototype._draw=function(){var e=new THREE.BufferGeometry;e.addAttribute("position",new THREE.Float32BufferAttribute(this._linesBufferPosition,3)),e.addAttribute("color",new THREE.Float32BufferAttribute(this._linesBufferColor,3)),e.setIndex(this._linesBufferIndex),e.computeBoundingSphere();var t=new THREE.LineSegments(e,new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors}));this.addRemoveMesh(t),this.add(t),this._particlesGeo.addAttribute("position",new THREE.BufferAttribute(new Float32Array(this._particlePositions),3)),this._particlesGeo.addAttribute("size",new THREE.BufferAttribute(new Float32Array(this._particleSizes),1)),this._particlesGeo.addAttribute("customColor",new THREE.BufferAttribute(new Float32Array(this._particleColors),3));var o={amplitude:{type:"f",value:1},color:{type:"c",value:new THREE.Color(16777215)},texture:{type:"t",value:(new THREE.TextureLoader).load("assets/images/particleA.png")}},n=new THREE.ShaderMaterial({uniforms:o,vertexShader:r._vertexShader,fragmentShader:r._fragmentShader,blending:THREE.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0}),i=new THREE.Points(this._particlesGeo,n);this.addRemoveMesh(i),this.pointSystem=i,i.dynamic=!0,this.add(i),i.update=function(){var e=this.geometry.attributes.position.array,t=0;for(var o in this.geometry.vertices){var n=this.geometry.vertices[o],i=n.path;n.lerpN+=n.speed,n.lerpN>1&&(n.lerpN=0,n.moveIndex=n.nextIndex,n.nextIndex++,n.nextIndex>=i.length&&(n.moveIndex=0,n.nextIndex=1));var r=i[n.moveIndex],a=i[n.nextIndex];n.copy(r),n.lerp(a,n.lerpN),e[t++]=n.x,e[t++]=n.y,e[t++]=n.z}this.geometry.attributes.position.needsUpdate=!0}}},function(e,t,o){"use strict";o.d(t,"a",function(){return a});var n=o(0),i=o(1),r=o(4),a=function(e){var t=n.a.isNull(e)?{}:e;i.a.call(this,t),this.setFromJson(t),this.h=1};a.prototype=Object.create(i.a.prototype),a.prototype.constructor=a,a.prototype.initProperties=function(){return[{name:"castShadow",value:!1,desc:"柱子是否投射阴影"},{name:"tooltip",value:"提示",desc:"提示"},{name:"tooltipShow",value:!0,desc:"是否显示提示"},{name:"tooltipColor",value:16777215,type:"color",desc:"提示文字颜色",gui:{}},{name:"tooltipScaleFactor",value:.25,desc:"提示缩放系数"},{name:"width",value:1,desc:"宽，对应x"},{name:"height",value:1,group:"高，对应y"},{name:"depth",value:1,group:"c",desc:"长，对应z"},{name:"color",value:16777215,group:"c",desc:"颜色，单个颜色或颜色数组",type:"color",gui:{folder:"Box"}},{name:"topColor",value:16777215,group:"c",desc:"颜色，单个颜色或颜色数组",type:"color",gui:{folder:"Box"}},{name:"bottomColor",value:16777215,group:"c",desc:"颜色，单个颜色或颜色数组",type:"color",gui:{folder:"Box"}},{name:"vertexColors",group:"m",value:THREE.FaceColors},{name:"animation",value:!0,group:"c",desc:"出现时是否有动画效果"},{name:"speed",value:1e3,group:"c",desc:"出现时动画速度"},{name:"transparent",value:!0,group:"m",desc:"是否允许透明",gui:{folder:"Box"}},{name:"opacity",value:.8,group:"m",desc:"不透明度,值0-1,1表示不透明",gui:{folder:"Box",max:1,min:0,step:.01}},{name:"roughness",value:.3,group:"m",desc:"粗糙度,值0-1,0表示光滑镜面",gui:{folder:"Box",max:1,min:0,step:.01}},{name:"metalness",value:.35,group:"m",desc:"金属性质,值0-1,0表示非金属表面",gui:{folder:"Box",max:1,min:0,step:.01}},{name:"bumpScale",value:1,group:"m",desc:"凹凸性质,值0-1",gui:{folder:"Box",max:1,min:0,step:.01}}]},a.prototype.heightChanged=function(e){if(!n.a.isNull(e)){var t=this;this.sy={scaleY:1},this._animationStatus=!0;new TWEEN.Tween(this.sy).to({scaleY:e},t.speed).onUpdate(function(){var e=t.sy.scaleY;t.box.scale.set(1,e,1)}).start().onComplete(function(){if(t._animationStatus=!1,t.tooltipShow){t.textSprite.visible=!0,t.textSprite.textPlant.geometry.computeBoundingBox();var o=new THREE.Vector3;t.textSprite.textPlant.geometry.boundingBox.getSize(o),t.textSprite.position.set(t.textSprite.position.x,e+o.y*t.tooltipScaleFactor,0)}})}},a.prototype.tooltipChanged=function(e){if(!n.a.isNull(e)){if(this.tooltipShow){this._animationStatus?this.textSprite.visible=!1:this.textSprite.visible=!0,this.textSprite.text=e,this.textSprite.textPlant.scale.set(this.tooltipScaleFactor,this.tooltipScaleFactor,1),this.textSprite.textPlant.geometry.computeBoundingBox();var t=new THREE.Vector3;this.textSprite.textPlant.geometry.boundingBox.getSize(t),this.textSprite.position.set(this.textSprite.position.x,this.height+t.y*this.tooltipScaleFactor,0)}}},a.prototype.tooltipColorChanged=function(e){n.a.isNull(e)||n.a.isNull(this.textSprite)||(this.textSprite.textPlant.material.color=new THREE.Color(e))},a.prototype.castShadowChanged=function(e){n.a.isNull(e)||n.a.isNull(this.box)||(this.box.castShadow=e)},a.prototype.colorChanged=function(e){n.a.isNull(e)||n.a.isNull(this.box)||(this.box.material.color=new THREE.Color(e))},a.prototype.topColorChanged=function(e){if(!n.a.isNull(e)&&!n.a.isNull(this.box)){var t=new THREE.Color(e),o=new THREE.Color(this.bottomColor),i=this.box.geometry;i.elementsNeedUpdate=!0,i.colorsNeedUpdate=!0;for(var r=0;r<12;++r)i.faces[r].vertexColors=4==r||5==r?[t,t,t]:6==r||7==r?[o,o,o]:r%2==0?[t,o,t]:[o,o,t]}},a.prototype.bottomColorChanged=function(e){if(!n.a.isNull(e)&&!n.a.isNull(this.box)){var t=new THREE.Color(this.topColor),o=new THREE.Color(e),i=this.box.geometry;i.elementsNeedUpdate=!0,i.colorsNeedUpdate=!0;for(var r=0;r<12;++r)i.faces[r].vertexColors=4==r||5==r?[t,t,t]:6==r||7==r?[o,o,o]:r%2==0?[t,o,t]:[o,o,t]}},a.prototype.roughnessChanged=function(e){n.a.isNull(e)||n.a.isNull(this.box)||(this.box.material.roughness=e)},a.prototype.bumpScaleChanged=function(e){n.a.isNull(e)||n.a.isNull(this.box)||(this.box.material.bumpScale=e)},a.prototype.metalnessChanged=function(e){n.a.isNull(e)||n.a.isNull(this.box)||(this.box.material.metalness=e)},a.prototype.transparentChanged=function(e){n.a.isNull(e)||n.a.isNull(this.box)||(this.box.material.transparent=e)},a.prototype.opacityChanged=function(e){n.a.isNull(e)||n.a.isNull(this.box)||this.transparent&&(this.box.material.opacity=e)},a.prototype.init=function(){this.drawBox()},a.prototype.update=function(e){n.a.isNull(this.textSprite)||this.textSprite.update(e)},a.prototype.drawBox=function(){var e=this.getByGroup("m"),t=new THREE.MeshStandardMaterial(e),o=function(e,t,o,n,i,r){"number"==typeof e&&(e=new THREE.Color(e));"number"==typeof t&&(t=new THREE.Color(t));for(var s=new THREE.BoxGeometry(o,n,i),l=0;l<s.vertices.length;l++){var u=s.vertices[l];u.y+=n/2}s.verticesNeedUpdate=!0;new THREE.ShaderMaterial({vertexColors:THREE.FaceColors,side:THREE.DoubleSide,transparent:!0,depthTest:!1,depthWrite:!0,vertexShader:a._vertexShader,fragmentShader:a._fragmentShader});for(var c=0;c<12;++c)s.faces[c].vertexColors=4==c||5==c?[t,t,t]:6==c||7==c?[e,e,e]:c%2==0?[t,e,t]:[e,e,t];return new THREE.Mesh(s,r)}(this.topColor,this.bottomColor,this.width,1,this.depth,t);o.castShadow=this.castShadow,this.box=o,this.addRemoveMesh(this.box),this.add(o),this.sy={scaleY:1};var n=this;if(this.tooltipShow){var i=new r.a({text:n.tooltip,color:n.tooltipColor});i.component=this.component,this.textSprite=i}new TWEEN.Tween(this.sy).to({scaleY:n.height},n.speed).onUpdate(function(){var e=n.sy.scaleY;n.box.scale.set(1,e,1)}).start().onComplete(function(){if(n.tooltipShow){i.init(),n.add(i),i.textPlant.scale.set(n.tooltipScaleFactor,n.tooltipScaleFactor,1),i.textPlant.geometry.computeBoundingBox();var e=i.textPlant.geometry.boundingBox.getSize();i.position.set(i.position.x,n.height+e.y*n.tooltipScaleFactor,0)}})},a._vertexShader="\n    attribute float alphaValue;\n    varying float vAlphaValue;\n    void main() {\n        vAlphaValue=alphaValue;\n        vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n        gl_Position = projectionMatrix * mvPosition;\n    }\n",a._fragmentShader="\n    varying float vAlphaValue;\n    void main() {\n        gl_FragColor=vec4(gl_FragColor.xyz,1);\n    }\n"}])});